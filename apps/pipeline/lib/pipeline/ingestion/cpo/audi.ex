defmodule Pipeline.Ingestion.CPO.Audi do
  @moduledoc """
  Reads pipe-delimited file of Audi inventory.

  Keys:
  "Information Partner Code"|"External Dealer Identifier"|"Stock Number"|"Vehicle Identification Number (VIN)"|"Affiliate Ad Identifier"|"Affiliate Profile Name (APN)"|"Inventory Date"|"Stock Type"|"Seller's Note"|"Manufacturer Description"|"Make Description"|"Model Description"|"Model Year"|"Trim Description"|"Vehicle Class Description"|"Body Style Description"|"Mileage"|"Door Count"|"Drive Train Description"|"Engine Description"|"Engine Displacement Description"|"Engine Cylinder Count"|"Fuel Type Code"|"Transmission Description"|"Wheelbase"|"Standard Feature Set"|"Optional Feature Set"|"Exterior Color Description"|"Exterior Standard Color Description"|"Interior Color Description"|"Interior Standard Color Description"|"List Price"|"MSRP"|"Invoice Price"|"Navigation System Indicator"|"Satellite Radio Code"|"Vehicle Photo URL"|"Meta Interface Type Description"|"Driver-Assistance System Code"|"Vehicle History Report URL"|"Vehicle Appraisal Sticker URL"|"Vehicle Video URL"|"Condition Type Code"|"Condition Description"|"Best Offer Indicator"

  Sample Line:
  "Audi-CPO"|"406A61"|"8701119"|"WAUB1GFF9G1037009"|""|""|"01012019"|"U"|"Audi Certified Pre-Owned - up to 5 years/unlimited mileage warranty w/ Complimentary Valet & Loaners. Original MSRP was $53,010, Black Optic Performance Package ($2,000), 19"" 5-V-spoke design wheels, Audi Magnetic Ride, Black Optic Exterior Package, Exterior Mirrors in body color, LED Lighting Package ($1,250), LED Headlights w/ LED DRL, LED Interior Lighting Package, Technology Package ($2,600), Audi MMI Navigation, Audi Side Assist, S Sport Seat Package ($1,450), Bang & Olufsen Sound System ($950), Red Brake Calipers ($400), Rear Backing Camera, Panoramic Sunroof, Bluetooth Audio & Handsfree Calling, Clean One-Owner Carfax Report. ***Four Brand New Tires - Brand New Front & Rear Brake Pads & Rotors*** Audi Certified pre-owned Details: * Transferable Warranty * Limited Warranty: 12 Month/Unlimited Mile beginning after new car warranty expires or from certified purchase date * 300+ Point Inspection * Warranty Deductible: $0 * Includes 24/7 Roadside Assistance including towing & trip interruption reimbursement. Transferability of the Audi CPO Limited Warranty to a subsequent private owner. CARFAX Vehicle History Report. **In order to ensure that you have a truly exceptional experience please call to confirm vehicle availability. Some vehicles maybe at an offsite storage facility.** Plus, with #1 Cochran's Market Based Pricing you can feel confident that you are receiving the Best Price and Value available to You! #1 Cochran has been providing the Tri-State area with excellent sales and service experiences for 50 Years. STOP! Buy Today! Let YOUR #1 Cochran experience begin!"|"Audi"|"Audi"|"S3"|"2016"|"2.0T Premium Plus"|""|"Sedan"|"44748"|"4"|""|"2.0L 2.0-liter TFSI four-cylinder engine"|""|""|""|"Dual Clutch 6-Speed Automatic"|""|""|"Tachometer,Spoiler,CD player,Air Conditioning,Traction control,Heated front seats,AM/FM radio: SiriusXM,Leather Seating Surfaces,Tilt steering wheel,Rear fog lights,Speed-sensing steering,S Sport Seats,Brake assist,Sport steering wheel,Illuminated entry,Auto-dimming Rear-View mirror,Steering wheel mounted audio controls,10 Speakers,19"" Performance Package,Fine Nappa Leather Interior,Outside temperature display,S Sport Seat Package,Power windows,Rear anti-roll bar,Power driver seat,Rear seat center armrest,Front anti-roll bar,Overhead airbag,Split folding rear seat,Rear reading lights,Driver vanity mirror,Trip computer,MP3 decoder,Power door mirrors,Leather Shift Knob,Front dual zone A/C,Low tire pressure warning,Radio: Audi Concert AM/FM/1CD Player,Bumpers: body-color,Automatic temperature control,Front reading lights,Passenger vanity mirror,High intensity discharge headlights: Xenon plus,Front Center Armrest,Panic alarm,Wheels: 8.0"" x 19"" 5-Double-Spoke-Star-Design,S3 Black Optic Performance Package,Radio data system,Power passenger seat,Knee airbag,Speed control,Power steering,Telescoping steering wheel,Dual front impact airbags,Rain sensing wipers,ABS brakes,Passenger door bin,Dual front side impact airbags,Audi Magnetic Ride,Electronic Stability Control,Power moonroof,Speed-Sensitive Wipers,Leather steering wheel,Turn signal indicator mirrors,Four wheel independent suspension,Delay-off headlights,Exterior Parking Camera Rear,Variably intermittent wipers,Rear window defroster,Occupant sensing airbag,Technology Package,Security system,Remote keyless entry,Front Bucket Seats,Compass,Driver door bin,Heated Front Sport Seats,4-Wheel Disc Brakes"|"Mythos black metallic"|"0E0E"|"Black"|"XG"|"31575.0"|""|""|""|""|"https://pictures.dealer.com/a/audipittsburghaoa/0425/25b0e7cca37f39835155b5c9041173ecx.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1309/7ce064e4eecdeb26020aeb282f85e53ex.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1478/014624b8e18bd90da18abd290faca482x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0633/3d76351630762296aa231b43dc7c79d7x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0638/b896862e95ef52fb94883a8f47c4381dx.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0006/b30fd865eb4d33bb9f99a8aa00a25985x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1409/bc6d9b737790bb89f28d5823000ca9d1x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1117/0498eca8baa454fad6c5501c168792b2x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0001/cfc9c7a2b3916da66eea23158d7cba17x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0800/079e0cdef4445b840ce7bae9e409a684x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1059/12841dc25eb58091110c0848855273a0x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0802/95e19b71dc5e6c8d2293455a5d61925ax.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0009/67a50265f5d74f0f8bdaad1771d5140cx.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0986/7e054ed2e18f9db106a41d2183345f35x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0712/0106108d70cb3dba60b844ef118b6667x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0807/b891c8a68e4641a8418afc3b0c01f963x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1449/feffa6a172b8dc8fa4d3c4f21e05907dx.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0753/ac242e66683026a646c277e547c9c1f1x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1658/16ea4a62050a83f20cc3d37151f750dex.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0543/aab4c9474d2567dfb5ce324c0f43ef19x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0208/e33232da8ded1c024875a251c8aad069x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1044/fb834bbdc5fd2486711bef7cf57c0975x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1484/ef39f16a94b8dcafb17ac3b8c0df4724x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0776/df33094edda96cf94938b4cd943c5e71x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1572/727b77b4919a0fb7c36205ca5bf96b9dx.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0212/570215bf0d6d754d85ce6d03e2edf18ex.jpg,https://pictures.dealer.com/a/audipittsburghaoa/1270/4b9e4e2856cc8d7614490e7efd31ab08x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0855/fe40a7544f78adb10bb1404adb37f51ax.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0707/6e8579d1d7d14ba48ec3223118b9188cx.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0989/59e3ffee7a016ac7c7b12a61e7d48de3x.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0286/923959e85b757ec2af63ef06ef922b4cx.jpg,https://pictures.dealer.com/a/audipittsburghaoa/0876/9b7a36c17ef9068bb17b2fb8771c95b8x.jpg"|"CPO"|""|""|""|""|""|""|""
  """

  alias Pipeline.Ingestion.Delimited

  @doc """
  Hello this is some documentation
  """
  def inventory_from_file(path) do
    Delimited.inventory_from_file(path, "|", "\"", &to_inventory/1)
  end

  def inventory_from_string(string) do
    Delimited.inventory_from_string(string, "|", "\"", &to_inventory/1)
  end

  def to_inventory(item) do
    %{
      make: Map.fetch!(item, "Make Description"),
      model: Map.fetch!(item, "Model Description"),
      price: Map.fetch!(item, "List Price"),
      miles: Map.fetch!(item, "Mileage"),
      year: Map.fetch!(item, "Model Year"),
      vin: Map.fetch!(item, "Vehicle Identification Number (VIN)"),
      external_dealer_id: Map.fetch!(item, "External Dealer Identifier")
    }
  end
end
